{% extends 'internal/internal.html' %}

{% block caption %}
Sprache: {{ language.name }}
{% endblock caption %}

{% block internal_body %}
<div class="row">
    <div class="col-lg-12">
        <dl>
            <dt>Anmeldebeginn</dt>
            <dd class="fmt-datetime">{{ language.signup_begin }}</dd>
            <dt>Anmeldeschluss</dt>
            <dd class="fmt-datetime">{{ language.signup_end }}</dd>
        </dl>
    </div>
</div>
<div class="row">
    <div class="col-lg-12">
        <table class="table table-striped sortable">
            <thead>
                <tr>
                    <th>Kurs</th>
                    <th>Maximal</th>
                    <th>RestplÃ¤tze</th>
                    <th>Bewerber</th>
                    <th>Aktive</th>
                    <th>Warteliste</th>
                    <th>Zahlungspf.</th>
                    <th>Kurs-L.</th>
                    <th>Anw.-L.</th>
                    <th>Daten</th>
                </tr>
            </thead>
            <tbody>
                {% set sums = {'limit': 0, 'rest': 0, 'attendances': 0, 'active': 0, 'waiting': 0, 'paying': 0} %}
                {% for course in language.courses %}
                <tr class="{% if course.is_overbooked() %}danger{% elif course.is_full() %}warning{% endif %}">
                    <td><a href="{{ url_for('course', id=course.id) }}"><strong>{{ course.full_name() }}</strong></a></td>
                    <td>{{ course.limit }}</td>
                    <td>{{ course.limit - course.get_active_attendances()|count }}</td>
                    <td>{{ course.attendances|count }}</td>
                    <td>{{ course.get_active_attendances()|count }}</td>
                    <td>{{ course.get_waiting_attendances()|count }}</td>
                    <td>{{ course.get_paying_attendances()|count }}</td>
                    <td><a href="{{ url_for('print_course', course_id=course.id) }}"><button type="button" class="btn btn-primary btn-xs">PDF</button></a></td>
                    <td><a href="{{ url_for('print_course_presence', course_id=course.id) }}"><button type="button" class="btn btn-primary btn-xs">PDF</button></a></td>
                    <td><a href="{{ url_for('export_course', course_id=course.id) }}"><button type="button" class="btn btn-primary btn-xs">CSV</button></a></td>
                </tr>
                {% if sums.update({
                  'limit': sums['limit'] + course.limit,
                  'rest': sums['rest'] + course.limit - course.get_active_attendances()|count,
                  'attendances': sums['attendances'] + course.attendances|count,
                  'active': sums['active'] + course.get_active_attendances()|count,
                  'waiting': sums['waiting'] + course.get_waiting_attendances()|count,
                  'paying': sums['paying'] + course.get_paying_attendances()|count,
                }) %}{% endif %}
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <th>&Sigma;</th>
                    <th>{{ sums['limit'] }}</th>
                    <th>{{ sums['rest'] }}</th>
                    <th>{{ sums['attendances'] }}</th>
                    <th>{{ sums['active'] }}</th>
                    <th>{{ sums['waiting'] }}</th>
                    <th>{{ sums['paying'] }}</th>
                    <th></th>
                    <th></th>
                </tr>
            </tfoot>
        </table>
    </div>
</div>
{% endblock internal_body %}

{# vim: set tabstop=4 shiftwidth=4 expandtab: #}
