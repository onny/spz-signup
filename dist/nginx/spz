server {
        listen 80;
        server_name "anmeldung.spz.kit.edu";
        return 301 https://$server_name$request_uri;
}

server {
        listen 443 default_server ssl;

        server_name "anmeldung.spz.kit.edu";
        ssl_certificate      "/etc/ssl/certs/anmeldung.spz.kit.edu.crt";
        ssl_certificate_key  "/etc/ssl/private/anmeldung.spz.kit.edu.key";
        keepalive_timeout    70;

        ssl_session_cache shared:SSL:10m;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers ECDHE-RSA-RC4-SHA:ECDHE-RSA-AES128-SHA:AES256-CGM-SHA256:ECDHE-RSA-AES256-SHA256:RC4:HIGH:!aNULL:!MD5:-LOW:-SSLv2:-EXP;
        ssl_prefer_server_ciphers on;
        add_header Strict-Transport-Security "max-age=2592000; includeSubdomains";

        location / {
            include uwsgi_params;
            uwsgi_pass unix:/tmp/spz-uwsgi.sock;
        }

        location /static/ {
            expires +1h;
            alias /opt/spz/app/spz/static/;
        }

        location /_stats {
            stub_status on;
        }

        add_header 'X-Frame-Options' 'deny';
        add_header 'X-Content-Type-Options' 'nosniff';
        add_header 'X-Download-Options' 'noopen';
        add_header 'X-XSS-Protection' '1; mode=block';

        # of course he we have to be a bit silly!
        add_header 'X-Powered-By:' 'Unicorns';
}
